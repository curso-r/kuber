<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Debugging exec.R • kuber</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Debugging exec.R">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kuber</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/debug_exec.html">Debugging exec.R</a>
    </li>
    <li>
      <a href="../articles/getting_started.html">Getting started</a>
    </li>
    <li>
      <a href="../articles/toy_example.html">Toy example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/curso-r/kuber">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Debugging exec.R</h1>
            
            <h4 class="date">2019-09-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/curso-r/kuber/blob/master/vignettes/debug_exec.Rmd"><code>vignettes/debug_exec.Rmd</code></a></small>
      <div class="hidden name"><code>debug_exec.Rmd</code></div>

    </div>

    
    
<p>Sometimes you might be faced with the fact that your <code>exec.R</code> file isn’t working properly. This may be due to problems in the file itself, in the way your script tries to upload the results to a bucket or on how the pods are handling arguments.</p>
<p>This vignette tries to show you how to debug your deployment on these three scenarios while at the same time giving you an example of how to write your <code>exec.R</code>.</p>
<div id="somethings-fishy" class="section level2">
<h2 class="hasAnchor">
<a href="#somethings-fishy" class="anchor"></a>Something’s fishy</h2>
<p>Suppose you’ve just been through the deployment workflow for your task:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(kuber)</span>
<span id="cb1-2"><a href="#cb1-2"></a></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="../reference/kub_create_cluster.html">kub_create_cluster</a></span>(<span class="st">"my-cluster"</span>)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt; ✔  Creating cluster</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw"><a href="../reference/kub_create_task.html">kub_create_task</a></span>(<span class="st">"~/my-dir"</span>, <span class="st">"my-cluster"</span>, <span class="st">"my-bucket"</span>, <span class="st">"my-image"</span>, <span class="st">"~/my-key.json"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; ✔  Fetching cluster information</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; ✔  Fetching bucket information</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; ✔  Creating bucket</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; ●  Edit `~/my-dir/exec.R'`</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; ●  Create `~/my-dir/list.rds` with usable objects</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; ●  Run `kub_push_task("~/my-dir")`</span></span>
<span id="cb1-13"><a href="#cb1-13"></a></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="kw"><a href="https://rdrr.io/r/utils/file.edit.html">file.edit</a></span>(<span class="st">"~/my-dir/exec.R"</span>)</span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="kw"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(<span class="st">"~/my-list.rds"</span>, <span class="st">"~/my-dir/list.rds"</span>, <span class="ot">TRUE</span>)</span>
<span id="cb1-16"><a href="#cb1-16"></a></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="kw"><a href="../reference/kub_push_task.html">kub_push_task</a></span>(<span class="st">"~/my-dir"</span>)</span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt; ✔  Building image</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt; ✔  Authenticating</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">#&gt; ✔  Pushing image</span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">#&gt; ✔  Removing old jobs</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#&gt; ✔  Creating new jobs</span></span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="kw"><a href="../reference/kub_run_task.html">kub_run_task</a></span>(<span class="st">"~/my-dir"</span>)</span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">#&gt; ✔  Authenticating</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">#&gt; ✔  Setting cluster context</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">#&gt; ✔  Creating jobs</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">#&gt; ●  Run `kub_list_pods()` to follow up on the pods</span></span></code></pre></div>
<p>But now, when you run <code><a href="../reference/kub_list_pods.html">kub_list_pods()</a></code>, the <code>STATUS</code> column says “Error” or some other equivalent undesirable message. First you must check whether</p>
</div>
<div id="your-script-isnt-working" class="section level2">
<h2 class="hasAnchor">
<a href="#your-script-isnt-working" class="anchor"></a>Your script isn’t working</h2>
<p>The first debug strategy should be lightly editing your <code>exec.R</code> file in order for it to run in your local machine. For instance, replace every instance of <code>save_rds()</code> with <code><a href="https://rdrr.io/r/base/readRDS.html">saveRDS()</a></code> and run the script locally:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1"></a>$ <span class="bu">cd</span> ~/my-dir/</span>
<span id="cb2-2"><a href="#cb2-2"></a>$ <span class="ex">Rscript</span> --vanilla exec.R 1 my-bucket</span></code></pre></div>
<p>If the expected RDS files aren’t written to disk, then your problem might be in the code. You can also run the script step by step by also replacing the command line arguments at the top of the file:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>idx &lt;-<span class="st"> </span><span class="dv">1</span>   <span class="co"># as.numeric(args[1])</span></span></code></pre></div>
<p>In case none of this works, then consider whether</p>
</div>
<div id="your-upload-isnt-working" class="section level2">
<h2 class="hasAnchor">
<a href="#your-upload-isnt-working" class="anchor"></a>Your upload isn’t working</h2>
<p>Now you should see what’s happening to the pods themselves. Run <code><a href="../reference/kub_list_pods.html">kub_list_pods()</a></code> and copy the name of the pod you want to examine:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1"></a>$ <span class="ex">kubectl</span> logs [POD_NAME]</span></code></pre></div>
<p>This command will show you the output of your script, which could inform your debugging process. If this isn’t enough, try running the docker container manually:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1"></a>$ <span class="ex">docker</span> run my-image Rscript exec.R 1 my-bucket</span></code></pre></div>
<p>This will execute your <code>exec.R</code> inside the container environment and is the closest you will get to your pod without getting inside it. Speaking of which, if nothing has worked up until now, then you should see whether</p>
</div>
<div id="your-pods-arent-working" class="section level2">
<h2 class="hasAnchor">
<a href="#your-pods-arent-working" class="anchor"></a>Your pods aren’t working</h2>
<p>To do this, you must open two terminal windows. In the first one, run your container:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1"></a>$ <span class="ex">docker</span> run my-image</span></code></pre></div>
<p>In the second one, get your container’s ID in order to access it:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1"></a>$ <span class="ex">docker</span> container list</span>
<span id="cb7-2"><a href="#cb7-2"></a>$ <span class="ex">docker</span> exec -it [CONTAINER_ID] /bin/bash</span></code></pre></div>
<p>With this last command, you’ll essentially be ssh-ing into your pod. This allows you to run any shell command you want, run R scripts in the local environment or even edit any files that might not be setup properly.</p>
<p>If even this doesn’t help you debug your deployment, please create an issue on <a href="https://github.com/curso-r/kuber">Github</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#somethings-fishy">Something’s fishy</a></li>
      <li><a href="#your-script-isnt-working">Your script isn’t working</a></li>
      <li><a href="#your-upload-isnt-working">Your upload isn’t working</a></li>
      <li><a href="#your-pods-arent-working">Your pods aren’t working</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by C Lente.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
