<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Create a docker directory with the kuber template for parallelism by expansion — kub_create_task • kuber</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Create a docker directory with the kuber template for parallelism by expansion — kub_create_task" />

<meta property="og:description" content="This function creates a directory with 5 components from the
kuber template: a Dockerfile (that is designed for expanded parallel taks),
an R file exec.R (which contains some code that guides how your program
should work), a job-tmpl.yaml (a template for the yaml files that will lauch
the docker jobs), an RDS list.rds (which contains as.list(seq(1, 10)) just
so you don't forget to setup the inputs that each job will take) and a jobs/
folder (where the actual job yaml files will go once you run kub_push_task()).
For more information, please see the sections below." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kuber</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/debug_exec.html">Debugging exec.R</a>
    </li>
    <li>
      <a href="../articles/getting_started.html">Getting started</a>
    </li>
    <li>
      <a href="../articles/toy_example.html">Toy example</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/platipusc/kuber">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Create a docker directory with the kuber template for parallelism by expansion</h1>
    <small class="dont-index">Source: <a href='https://github.com/platipusc/kuber/blob/master/R/task.R'><code>R/task.R</code></a></small>
    <div class="hidden name"><code>kub_create_task.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This function creates a directory with 5 components from the
kuber template: a <code>Dockerfile</code> (that is designed for expanded parallel taks),
an R file <code>exec.R</code> (which contains some code that guides how your program
should work), a <code>job-tmpl.yaml</code> (a template for the yaml files that will lauch
the docker jobs), an RDS <code>list.rds</code> (which contains <code><a href='https://www.rdocumentation.org/packages/base/topics/list'>as.list(seq(1, 10))</a></code> just
so you don't forget to setup the inputs that each job will take) and a <code>jobs/</code>
folder (where the actual job yaml files will go once you run <code><a href='kub_push_task.html'>kub_push_task()</a></code>).
For more information, please see the sections below.</p>
    
    </div>

    <pre class="usage"><span class='fu'>kub_create_task</span>(<span class='no'>path</span>, <span class='no'>cluster_name</span>, <span class='no'>bucket_name</span>, <span class='no'>image_name</span>,
  <span class='no'>service_account</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>path</th>
      <td><p>Directory where to initialize task (will be set as default for
other Kuber functions)</p></td>
    </tr>
    <tr>
      <th>cluster_name</th>
      <td><p>Name of the cluster where to execute jobs (must exist
already)</p></td>
    </tr>
    <tr>
      <th>bucket_name</th>
      <td><p>Name of the storage bucket where the files will be stored
(will be created if necessary)</p></td>
    </tr>
    <tr>
      <th>image_name</th>
      <td><p>Name of the docker image where to build the container (either
its full path in the form <code>[HOSTNAME]/[PROJECT_ID]/[IMAGE_NAME]:[VERSION]</code> or
simply <code>[IMAGE_NAME]</code> for it to be automatically pushed to the Google Cloud
Registry)</p></td>
    </tr>
    <tr>
      <th>service_account</th>
      <td><p>Path to the Service Account JSON file that will be
used to authenticate <code>gsutil</code> inside each container (must be a storage object
administrator)</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Path where the kuber folder was created</p>
    
    <h2 class="hasAnchor" id="dockerfile"><a class="anchor" href="#dockerfile"></a>Dockerfile</h2>

    
    <p>This is a very simple <code>Dockerfile</code> based on <code>rocker/tidyverse</code> that installs
<code>tidyverse</code>, <code>devtools</code> and <code>abjutils</code>, and copies <code>exec.R</code> and <code>list.rds</code> to
the home directory. If you have any extra dependencies or want to use more
files for your script, this is where you should add them.</p>
    
    <h2 class="hasAnchor" id="exec-r"><a class="anchor" href="#exec-r"></a>Exec.R</h2>

    
    <p>The <code>exec.R</code> file is only a guide for what your script should probably be
doing. It gets the number of the current job as its only argument, saves a
result file as an RDS and uploads that file to the desired bucket. For more
information, see the "Toy example" vignette; if you're having problems, see
the "Debugging exec.R" vignette.</p>
    
    <h2 class="hasAnchor" id="job-tmpl-yaml"><a class="anchor" href="#job-tmpl-yaml"></a>Job-tmpl.yaml</h2>

    
    <p>The job template is a very simple file that describes how the job should be
run once it is activated by the pod, which is essentially running
<code>Rscript --vanilla exec.R [JOB_NUMBER]</code>. Since this template uses parallelism
via expansion, <code><a href='kub_push_task.html'>kub_push_task()</a></code> will expand this template into as many job
files as you want.</p>
    
    <h2 class="hasAnchor" id="jobs-"><a class="anchor" href="#jobs-"></a>Jobs/</h2>

    
    <p>This is simply a folder that will store the job files once the template is
expanded.</p>
    
    <h2 class="hasAnchor" id="list-rds"><a class="anchor" href="#list-rds"></a>List.rds</h2>

    
    <p>This is more of a suggestion than a required file. It contains (by default)
a <code><a href='https://www.rdocumentation.org/packages/base/topics/list'>list()</a></code> with each integer from 1 to 10, but actually it could be any list
of your choosing. The goal here is to be able to get the arguments for your
script just by extracting the element with index equal to the job number
(meaning that job number <code>N</code> might read and use everything stored in <code>list.rds</code>
at index <code>[[N]]</code>). To illustrate this concept, take for example a webscraping
script: <code>list.rds</code> would contain a list where each element is a character
vector of URLs to scrape; each job would therefore read the file but only
scrape <code>list[[N]]</code> so that it doesn't overlap with any other job. Fore more
information, see the "Toy example" vignette.</p>
    
    <h2 class="hasAnchor" id="service-account"><a class="anchor" href="#service-account"></a>Service account</h2>

    
    <p>In order to create a service account (necessary to manage storage resources
remotely) you must access <a href='https://console.cloud.google.com/iam-admin/serviceaccounts'>https://console.cloud.google.com/iam-admin/serviceaccounts</a>
and add to it the "storage object administrator" role. You should then click
on the account and generate a key as a JSON file. This file will be downloaded
to your computer and can be referenced via the <code>service_account</code> argument.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p><a href='https://kubernetes.io/docs/tasks/job/parallel-processing-expansion/'>https://kubernetes.io/docs/tasks/job/parallel-processing-expansion/</a>
<a href='https://cloud.google.com/container-registry/docs/quickstart'>https://cloud.google.com/container-registry/docs/quickstart</a></p>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#dockerfile">Dockerfile</a></li>

      <li><a href="#exec-r">Exec.R</a></li>

      <li><a href="#job-tmpl-yaml">Job-tmpl.yaml</a></li>

      <li><a href="#jobs-">Jobs/</a></li>

      <li><a href="#list-rds">List.rds</a></li>

      <li><a href="#service-account">Service account</a></li>

      <li><a href="#references">References</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Caio Lente.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

